#!/bin/sh /etc/rc.common
# Copyright (C) 2010-2011 OpenWrt.org

START=50
STOP=10

SERVICE_DAEMONIZE=1
SERVICE_STOP_TIME=9

error() {
	echo "${initscript}:" "$@" 1>&2
}

start() {
    mkdir -m 0700 -p /data/mysql
    chown -R mysql:mysql /data/mysql

    mkdir -m 0700 -p /var/log/mysql
    chown -R mysql:mysql /var/log/mysql

	if [ ! -f "/data/mysql/mysql/tables_priv.MYD" ]; then
		/usr/bin/mysql_install_db --force
	fi
	service_start /usr/bin/mysqld
    
    chmod 0770 /var/run/mysqld.sock
    chown mysql:yunapbx /var/run/mysqld.sock
}

stop() {
	service_stop /usr/bin/mysqld
}
